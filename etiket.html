/* =========================
   ETIKET.GS
========================= */
const SPREADSHEET_ID = "1tZLwFMTsn_GjYA3UrTUF1c0mYCkHmMwknEsMVquac-E";
const SHEET_NAME = "db_mahika";

function doGet(e){
  const sheet = SpreadsheetApp.openById(SPREADSHEET_ID).getSheetByName(SHEET_NAME);
  const lastRow = sheet.getLastRow();
  if(lastRow<2) return jsonOutput({});

  const row = sheet.getRange(lastRow,1,1,8).getValues()[0];

  return jsonOutput({
    tanggal: Utilities.formatDate(row[0],"Asia/Jakarta","yyyy-MM-dd"),
    nama: row[1],
    no_hp: row[2].toString(),
    armada: row[3],
    jam: row[4],
    tujuan: row[5],
    no_kursi: row[6],
    harga: row[7]
  });
}

function doPost(e){
  const sheet = SpreadsheetApp.openById(SPREADSHEET_ID).getSheetByName(SHEET_NAME);
  const data = JSON.parse(e.postData.contents);

  sheet.appendRow([
    new Date(data.tanggal),
    data.nama,
    data.no_hp.toString(),
    data.armada,
    data.jam,
    data.tujuan,
    data.no_kursi,
    data.harga
  ]);

  return jsonOutput({status:"success"});
}

function jsonOutput(obj){
  return ContentService.createTextOutput(JSON.stringify(obj))
                       .setMimeType(ContentService.MimeType.JSON);
}
